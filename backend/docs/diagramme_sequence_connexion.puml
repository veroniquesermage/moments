@startuml
actor Utilisateur
participant Frontend
participant Backend

== Connexion (détection) ==
Utilisateur -> Frontend : Cliquer sur "Se connecter"
Frontend -> Backend : POST /auth/check-user { email, isGoogleLogin }

alt Utilisateur trouvé
  Backend -> Frontend : 200 OK

  alt isGoogleLogin = true
    Frontend -> Google : Redirection OAuth2
    Google -> Frontend : Code
    Frontend -> Backend : POST /auth/google-login
    Backend -> Backend : Vérification + JWT
    Backend --> Frontend : Cookies + profil
    Frontend -> Frontend : Récupération groupes → navigation
  else isGoogleLogin = false
    Frontend -> Backend : POST /auth/login { email, password }
    alt mot de passe correct
      Backend -> Backend : Vérification + JWT
      Backend --> Frontend : Cookies + profil
      Frontend -> Frontend : Récupération groupes → navigation
    else mot de passe incorrect
      Backend --> Frontend : 401 Unauthorized
      Frontend -> Utilisateur : Affiche modale "Mot de passe incorrect"
      Utilisateur -> Frontend : Clique "Mot de passe oublié ?"
      Frontend -> Backend : POST /auth/password-reset-request { email }
      Backend -> Backend : Génère token + envoi email
      Utilisateur -> Backend : Clique sur lien reçu (token)
      Frontend -> Utilisateur : Formulaire de nouveau mot de passe
      Utilisateur -> Frontend : Envoie nouveau mot de passe
      Frontend -> Backend : POST /auth/reset-password { token, newPassword }
      Backend -> Backend : Mise à jour + email de confirmation
    end
  end

else Utilisateur inconnu
  Backend -> Frontend : 404 Not Found
  Frontend -> Utilisateur : Affiche modale "Créer un compte ?"
  Utilisateur -> Frontend : Clique sur "Créer mon compte"
  Frontend -> Backend : POST /auth/register
  Backend -> Backend : Création utilisateur
  Backend --> Frontend : Cookies + profil
  Frontend -> Frontend : Récupération groupes → navigation
end
@enduml